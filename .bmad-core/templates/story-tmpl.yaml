# <!-- Powered by BMADâ„¢ Core -->
template:
  id: story-template-v2
  name: Story Document
  version: 2.0
  output:
    format: github-issue-body
    script_call: "github-issue-manager.sh create-story {{epic_num}} \"Story {{epic_num}}.{{story_num}}: {{story_title_short}}\" \"{{rendered_body}}\" \"{{story_slug}}\" \"{{epic_slug}}\""
    # slug-creation-rules: derive from story_title_short, lowercase, hyphens instead of spaces, alphanumeric and hyphens only, max 30 characters, use well known abbreviations where possible (e.g., "auth" for "authentication"), omit stop words (e.g., "the", "and", "of")
    title: "Story {{epic_num}}.{{story_num}}: {{story_title_short}}"
    labels: ["story", "epic-{{epic_num}}", "draft"]
    milestone: "Epic {{epic_num}}"

workflow:
  mode: interactive
  elicitation: advanced-elicitation

agent_config:
  editable_sections:
    - Story
    - Acceptance Criteria
    - Gherkin Scenarios
    - Step Definitions Status
    - Tasks / Subtasks
    - Dev Notes
    - Testing
    - Change Log

sections:

  - id: story
    title: Story
    type: template-text
    template: |
      **As a** {{role}},
      **I want** {{action}},
      **so that** {{benefit}}
    instruction: Define the user story using the standard format with role, action, and benefit
    elicit: true
    owner: scrum-master
    editors: [scrum-master]

  - id: acceptance-criteria
    title: Acceptance Criteria
    type: numbered-list
    instruction: Copy the acceptance criteria numbered list from the epic file
    elicit: true
    owner: scrum-master
    editors: [scrum-master]

  - id: tasks-subtasks
    title: Tasks / Subtasks
    type: bullet-list
    instruction: |
      Break down the story into specific tasks and subtasks needed for implementation.
      Reference applicable acceptance criteria numbers where relevant.
      
      NOTE: In GitHub issues workflow, main tasks will be created as sub-issues.
      Use this section for task descriptions that will become issue titles and bodies.
      
      IMPORTANT: After subtask issues are created, remove the detailed descriptions from this section and keep only task titles with links to the subtask issues.
    template: |
      - Task 1: [Brief title] (AC: # if applicable)
        - Description: [Detailed task description for sub-issue body]
        - Subtask1.1...
      - Task 2: [Brief title] (AC: # if applicable)
        - Description: [Detailed task description for sub-issue body]
        - Subtask 2.1...
      - Task 3: [Brief title] (AC: # if applicable)
        - Description: [Detailed task description for sub-issue body]
        - Subtask 3.1...
    elicit: true
    owner: scrum-master
    editors: [scrum-master, dev-agent]
    post_process: |
      For each main task, create sub-issue using:
      github-issue-manager.sh create-task {{story_num}} "{{task_title}}" "{{task_description}}" "{{epic_slug}}" "{{story_slug}}"
      slug-creation-rules: derive from task_title, lowercase, hyphens instead of spaces, alphanumeric and hyphens only, max 30 characters, use well known abbreviations where possible (e.g., "auth" for "authentication"), omit stop words (e.g., "the", "and", "of")
      
      **AFTER SUBTASK CREATION**: Remove detailed descriptions from this section and update to:
      - Task 1: [Brief title] (AC: #) - See subtask issue #123
      - Task 2: [Brief title] (AC: #) - See subtask issue #124
      

  - id: gherkin-scenarios
    title: Gherkin Scenarios
    type: text
    instruction: |
      Comprehensive Gherkin feature file with scenarios covering:
      - Happy path scenarios (primary user journeys)
      - Unhappy path scenarios (validation failures, errors)
      - Edge case scenarios (boundary conditions, empty inputs)
      - Security scenarios (malicious input testing)
      
      This section is populated by QA Agent using create-feature-files task.
      All user-observable acceptance criteria MUST have corresponding Gherkin scenarios.
    template: |
      **Feature File:** `tests/features/{epic_slug}/{story_slug}.feature`
      
      **Status:** ðŸŸ¡ Pending creation (use `*feature-files {story}` command)
      
      **Scenario Coverage Required:**
      - [ ] Happy path scenarios for each AC with user-observable consequences
      - [ ] Unhappy path scenarios (validation, errors)
      - [ ] Edge case scenarios (boundary conditions)
      - [ ] Security scenarios (malicious input protection)
      
      **Gherkin Content:** [Will be populated by QA Agent]
    owner: qa-agent
    editors: [qa-agent]

  - id: step-definitions-status
    title: Step Definitions Status
    type: text
    instruction: |
      Track the creation and implementation status of Cucumber step definitions.
      Step definitions provide the implementation bridge between Gherkin scenarios and test code.
      This section is managed by both QA Agent (creation) and Dev Agent (implementation).
    template: |
      **Step Definition Files:**
      - `tests/steps/{story_slug}-steps.js` (Playwright-based)
      - `tests/steps/security-steps.js` (Security scenarios)
      - `tests/support/hooks.js` (Playwright setup)
      
      **Creation Status:** ðŸŸ¡ Pending (use `*step-defs {story}` command)
      **Implementation Status:** ðŸ”´ Not started
      **Execution Status:** âšª Not tested
      
      **Step Definition Counts:**
      - Given steps: 0
      - When steps: 0
      - Then steps: 0
      - Security steps: 0
      
      **Implementation Notes:** [Updated by Dev Agent during implementation]
    owner: qa-agent
    editors: [qa-agent, dev-agent]

  - id: dev-notes
    title: Dev Notes
    instruction: |
      Populate relevant information, only what was pulled from actual artifacts from docs folder, relevant to this story:
      - Do not invent information
      - If known add Relevant Source Tree info that relates to this story
      - If there were important notes from previous story that are relevant to this one, include them here
      - Put enough information in this section so that the dev agent should NEVER need to read the architecture documents, these notes along with the tasks and subtasks must give the Dev Agent the complete context it needs to comprehend with the least amount of overhead the information to complete the story, meeting all AC and completing all tasks+subtasks
    elicit: true
    owner: scrum-master
    editors: [scrum-master]
    sections:
      - id: testing-standards
        title: Testing
        instruction: |
          List Relevant Testing Standards from Architecture the Developer needs to conform to:
          - Test file location
          - Test standards
          - Testing frameworks and patterns to use
          - Any specific testing requirements for this story
        elicit: true
        owner: scrum-master
        editors: [scrum-master]

  - id: change-log
    title: Change Log
    type: table
    columns: [Date, Version, Description, Author]
    instruction: Track changes made to this story document
    owner: scrum-master
    editors: [scrum-master, dev-agent, qa-agent]

  - id: dev-agent-record
    title: Dev Agent Record
    instruction: This section is populated by the development agent during implementation
    owner: dev-agent
    editors: [dev-agent]
    sections:
      - id: agent-model
        title: Agent Model Used
        template: "{{agent_model_name_version}}"
        instruction: Record the specific AI agent model and version used for development
        owner: dev-agent
        editors: [dev-agent]

      - id: debug-log-references
        title: Debug Log References
        instruction: Reference any debug logs or traces generated during development
        owner: dev-agent
        editors: [dev-agent]

      - id: completion-notes
        title: Completion Notes List
        instruction: Notes about the completion of tasks and any issues encountered
        owner: dev-agent
        editors: [dev-agent]

      - id: file-list
        title: File List
        instruction: List all files created, modified, or affected during story implementation
        owner: dev-agent
        editors: [dev-agent]

  - id: qa-results
    title: QA Results
    instruction: Results from QA Agent QA review of the completed story implementation
    owner: qa-agent
    editors: [qa-agent]
